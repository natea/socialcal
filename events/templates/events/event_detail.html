{% extends "base.html" %}
{% load static %}

{% block title %}{{ event.title }}{% endblock %}

{% block content %}
<div class="event-detail">
    {% if event.image %}
        <img src="{{ event.image.url }}" alt="{{ event.title }}" class="event-banner">
    {% endif %}
    
    <div class="event-header">
        <h1>{{ event.title }}</h1>
        
        <div class="event-meta">
            <p><i class="bi bi-calendar"></i> {{ event.start_time|date:"F j, Y" }} at {{ event.start_time|date:"g:i A" }}</p>
            {% if event.venue_name %}
                <p><i class="bi bi-geo-alt"></i> {{ event.venue_name }}</p>
            {% endif %}
        </div>
        
        {% if user.is_authenticated %}
            <div class="event-actions mb-3">
                <button class="btn btn-outline-primary star-button {% if event.is_starred %}active{% endif %}" 
                        data-event-id="{{ event.id }}">
                    <i class="bi {% if event.is_starred %}bi-star-fill{% else %}bi-star{% endif %}"></i>
                    Star
                </button>
                
                {% if user == event.user %}
                    <a href="{% url 'events:edit' event.id %}" class="btn btn-outline-secondary">
                        <i class="bi bi-pencil"></i> Edit
                    </a>
                    <a href="{% url 'events:delete' event.id %}" class="btn btn-outline-danger">
                        <i class="bi bi-trash"></i> Delete
                    </a>
                {% endif %}
            </div>
            
            <div class="calendar-actions mb-3">
                <a href="{% url 'events:export_ical' %}?event_id={{ event.id }}" 
                   data-protocol="webcal" 
                   class="btn btn-outline-success">
                    <i class="bi bi-calendar-plus"></i> Subscribe to Calendar
                </a>
                <a href="{% url 'events:export_ical' %}?event_id={{ event.id }}" 
                   class="btn btn-outline-secondary">
                    <i class="bi bi-download"></i> Download iCal
                </a>
            </div>
        {% endif %}
        
        <div class="event-description">
            {{ event.description|linebreaks }}
        </div>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Star button functionality
    const starButton = document.querySelector('.star-button');
    if (starButton) {
        starButton.addEventListener('click', function() {
            const eventId = this.dataset.eventId;
            const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            
            fetch(`/events/${eventId}/star/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Requested-With': 'XMLHttpRequest',
                    'X-CSRFToken': csrftoken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // Update UI based on response
                    const starIcon = button.querySelector('i');
                    if (data.is_starred) {
                        button.classList.add('active');
                        starIcon.classList.remove('bi-star');
                        starIcon.classList.add('bi-star-fill');
                    } else {
                        button.classList.remove('active');
                        starIcon.classList.remove('bi-star-fill');
                        starIcon.classList.add('bi-star');
                    }
                } else {
                    console.error('Error updating star status:', data.error);
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    }
});
</script>
{% endblock %}
{% endblock %} 